# Test error handling

# Start gateway
exec emx-gate &
sleep 4s

# Test unknown model (returns mock response)
exec curl --noproxy "*" -s -X POST http://127.0.0.1:8848/v1/chat/completions -H "Content-Type: application/json" -d '{"model":"openai.gpt-4","messages":[{"role":"user","content":"Hello"}]}'
stdout 'chatcmpl-mock'

# Test invalid endpoint returns 404
exec curl --noproxy "*" -s -w "%{http_code}" http://127.0.0.1:8848/invalid/endpoint
stdout '404'

# Clean up
[windows] ? exec powershell.exe -Command "Stop-Process -Name emx-gate -Force -ErrorAction SilentlyContinue"
[unix] ? exec pkill -f emx-gate
