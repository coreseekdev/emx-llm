# Test model and provider listing endpoints

# Start gateway
exec emx-gate &
sleep 4s

# Test /v1/models endpoint
exec curl --noproxy "*" -s http://127.0.0.1:8848/v1/models
stdout 'list'
stdout 'data'

# Verify specific models exist
exec curl --noproxy "*" -s http://127.0.0.1:8848/v1/models
stdout 'openai.gpt-4'

exec curl --noproxy "*" -s http://127.0.0.1:8848/v1/models
stdout 'anthropic.claude-3-opus-20240229'

# Test /v1/providers endpoint
exec curl --noproxy "*" -s http://127.0.0.1:8848/v1/providers
stdout 'list'
stdout 'data'

# Verify provider types
exec curl --noproxy "*" -s http://127.0.0.1:8848/v1/providers
stdout 'openai'

exec curl --noproxy "*" -s http://127.0.0.1:8848/v1/providers
stdout 'anthropic'

# Clean up
[windows] ? exec powershell.exe -Command "Stop-Process -Name emx-gate -Force -ErrorAction SilentlyContinue"
[unix] ? exec pkill -f emx-gate
